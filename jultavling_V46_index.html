<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <title>L√§mne√• Bruk ‚Äì Christmas Sweater Competition</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --brand-blue: #00558c;
      --brand-blue-light: #007cc0;
      --brand-gold: #ffb300;
      --brand-green: #2e7d32;
      --bg-soft: #f5f8ff;
      --text-main: #13314b;
      --text-muted: #60758b;
      --border-subtle: #dde5f0;
      --card-radius: 18px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--text-main);
      background:
        radial-gradient(circle at top left, #eef6ff 0, #f6f7ff 35%, #e3edff 70%, #dbe5ff 100%);
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }

    /* Animated snow */
    body::before,
    body::after {
      content: "";
      position: fixed;
      inset: -40px;
      pointer-events: none;
      background-image:
        radial-gradient(circle at 10% 20%, rgba(255,255,255,0.8) 0, transparent 52%),
        radial-gradient(circle at 80% 0%, rgba(255,255,255,0.65) 0, transparent 55%),
        radial-gradient(circle at 0% 80%, rgba(255,255,255,0.7) 0, transparent 55%),
        radial-gradient(circle at 100% 70%, rgba(255,255,255,0.6) 0, transparent 55%);
      background-repeat: no-repeat;
      z-index: -1;
      animation: snowDrift 36s linear infinite;
      opacity: 0.9;
    }

    body::after {
      animation-duration: 52s;
      opacity: 0.6;
      filter: blur(1px);
    }

    @keyframes snowDrift {
      from { transform: translateY(-20px); }
      to   { transform: translateY(20px); }
    }

    main {
      max-width: 1100px;
      margin: 26px auto 40px auto;
      padding: 0 18px 32px 18px;
    }

    header {
      background: linear-gradient(95deg, #00558c, #007cc0);
      color: #fff;
      padding: 16px 24px 18px 24px;
      border-radius: 18px 18px 0 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 8px 24px rgba(0,0,0,0.18);
      position: relative;
      overflow: hidden;
    }

    header::after {
      content: "";
      position: absolute;
      left: 0;
      right: 0;
      bottom: 0;
      height: 4px;
      background: linear-gradient(90deg, #c62828, #ffb300, #2e7d32);
      opacity: 0.95;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .logo-circle {
      width: 46px;
      height: 46px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 18%, #ffffff 0, #e3f2fd 40%, #003b63 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 20px;
      box-shadow: 0 4px 14px rgba(0,0,0,0.3);
    }

    .logo-circle span {
      letter-spacing: 0.08em;
    }

    .header-title h1 {
      margin: 0;
      font-size: 20px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
    }

    .header-title span {
      display: block;
      font-size: 13px;
      opacity: 0.9;
      margin-top: 2px;
    }

    .header-right {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 6px;
      font-size: 13px;
    }

    .header-right .login-status {
      opacity: 0.9;
    }

    .header-right .xmas-label {
      font-size: 12px;
      padding: 3px 10px;
      border-radius: 999px;
      background: linear-gradient(135deg, rgba(255,255,255,0.2), rgba(255,255,255,0.04));
      border: 1px solid rgba(255,255,255,0.4);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .header-right .xmas-label span.emoji {
      font-size: 15px;
    }

    .card {
      background: rgba(255,255,255,0.98);
      border-radius: 0 0 var(--card-radius) var(--card-radius);
      padding: 10px 22px 22px 22px;
      box-shadow: 0 18px 40px rgba(0,0,0,0.12);
      border: 1px solid rgba(255,255,255,0.7);
      backdrop-filter: blur(18px);
      position: relative;
      isolation: isolate;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      border: 1px solid rgba(255,255,255,0.8);
      pointer-events: none;
    }

    .top-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }

    .nav-tabs {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .nav-button {
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,0.07);
      padding: 7px 18px;
      font-size: 14px;
      background: rgba(248,251,255,0.98);
      color: var(--text-main);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 2px 4px rgba(15,32,52,0.12);
      transition: background 0.16s ease, box-shadow 0.16s ease, transform 0.1s ease, color 0.16s ease, border-color 0.16s ease;
      backdrop-filter: blur(12px);
    }

    .nav-button span.emoji {
      font-size: 16px;
    }

    .nav-button:hover {
      background: #f3f8ff;
      box-shadow: 0 3px 10px rgba(0,0,0,0.18);
      transform: translateY(-1px);
    }

    .nav-button.active {
      background: linear-gradient(135deg, #00558c, #007cc0);
      color: #fff;
      border-color: #00466f;
      box-shadow: 0 4px 14px rgba(0,86,141,0.55);
    }

    .top-actions {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
      font-size: 13px;
      color: var(--text-muted);
    }

    .button {
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      padding: 8px 18px;
      font-size: 14px;
      background: #ffffff;
      color: var(--text-main);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.08);
      transition: background 0.16s ease, transform 0.1s ease, box-shadow 0.16s ease, color 0.16s ease, border-color 0.16s ease;
    }

    .button.small {
      padding: 6px 14px;
      font-size: 13px;
    }

    .button:hover {
      background: #f4f8ff;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.12);
    }

    .button.secondary {
      background: #f7f9fc;
    }

    .button.secondary:hover {
      background: #eef4ff;
    }

    .button.danger {
      background: linear-gradient(135deg, #c62828, #ef6c00);
      color: #fff;
      border-color: #b71c1c;
    }

    .button.danger:hover {
      background: linear-gradient(135deg, #b71c1c, #e65100);
      box-shadow: 0 4px 12px rgba(183,28,28,0.5);
    }

    .button[disabled],
    .button.disabled {
      opacity: 0.45;
      cursor: default;
      box-shadow: none;
      transform: none;
    }

    .info-banner {
      margin: 8px 0 18px 0;
      border-radius: 10px;
      padding: 10px 14px;
      background: linear-gradient(120deg, #e6f2ff, #f2f7ff);
      border: 1px solid rgba(0,0,0,0.04);
      font-size: 13px;
      color: var(--text-muted);
      display: flex;
      align-items: flex-start;
      gap: 10px;
    }

    .info-banner .bar {
      width: 4px;
      border-radius: 999px;
      background: linear-gradient(180deg, #00558c, #00a0ff);
      flex-shrink: 0;
    }

    .info-banner strong {
      color: #123759;
    }

    .view {
      display: none;
    }

    .view.active {
      display: block;
    }

    h2 {
      margin: 0 0 10px 0;
      font-size: 22px;
    }

    p {
      margin: 0 0 10px 0;
      font-size: 14px;
      color: var(--text-muted);
    }

    .category-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 8px 0 14px 0;
    }

    .category-chip {
      border-radius: 999px;
      padding: 7px 14px;
      border: 1px solid #d2dff0;
      background: #f6f9ff;
      cursor: pointer;
      font-size: 14px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      color: var(--text-main);
      transition: background 0.16s ease, border-color 0.16s ease, box-shadow 0.16s ease, transform 0.1s ease;
    }

    .category-chip span.icon {
      font-size: 16px;
    }

    .category-chip.selected {
      background: linear-gradient(135deg, #00558c, #007ec5);
      color: #fff;
      border-color: #00466f;
      box-shadow: 0 4px 12px rgba(0,86,141,0.45);
      transform: translateY(-1px);
    }

    .status-text {
      margin-bottom: 12px;
      font-size: 14px;
    }

    .status-text span {
      color: #146a1c;
      font-weight: 600;
    }

    .message {
      margin-top: 6px;
      font-size: 13px;
      color: var(--text-muted);
    }

    .message.success {
      color: #146a1c;
    }

    .message.error {
      color: #b71c1c;
    }

    .home-grid {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 10px;
    }

    .home-card {
      padding: 10px 14px 12px 14px;
      border-radius: 14px;
      background: radial-gradient(circle at top left, #ffffff 0, #f6fbff 55%, #edf5ff 100%);
      border: 1px solid #e0ebff;
      box-shadow: 0 6px 20px rgba(15,40,70,0.05);
    }

    .home-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin-bottom: 6px;
    }

    .home-card-title {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
      color: var(--text-main);
    }

    .home-card-title span.emoji {
      font-size: 18px;
    }

    .home-card-badge {
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      background: linear-gradient(135deg, rgba(255,255,255,0.7), rgba(255,255,255,0.4));
      border: 1px solid rgba(255,255,255,0.8);
      color: #4e342e;
    }

    .category-section {
      margin-top: 12px;
    }

    .category-section h3 {
      margin: 0 0 8px 0;
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .category-section h3 span.emoji {
      font-size: 17px;
    }

    .entry-list {
      border-radius: 14px;
      border: 1px solid #e0e8f4;
      background: #ffffff;
      overflow: hidden;
    }

    .entry-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 12px;
      font-size: 14px;
      border-top: 1px solid #f2f4fb;
    }

    .entry-row:first-child {
      border-top: none;
    }

    .entry-main {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .position-badge {
      min-width: 38px;
      text-align: center;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 12px;
      border: 1px solid #e0e0e0;
      background: #f7f7f7;
      color: #555;
    }

    .position-gold {
      background: #ffefc2;
      border-color: #f6c453;
      color: #8a5a00;
    }

    .position-silver {
      background: #eceff5;
      border-color: #c2cad8;
      color: #495063;
    }

    .position-bronze {
      background: #ffe0c2;
      border-color: #f4a562;
      color: #7a3e00;
    }

    .entry-name {
      font-weight: 500;
    }

    .entry-right {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 13px;
      color: var(--text-muted);
    }

    .tie-badge {
      padding: 2px 10px;
      border-radius: 999px;
      font-size: 12px;
      background: #e3f2fd;
      color: #0d47a1;
      border: 1px solid #bbdefb;
    }

    .vote-list {
      margin-top: 10px;
      border-radius: 14px;
      border: 1px solid #e0e8f4;
      background: #ffffff;
      overflow: hidden;
    }

    .vote-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 12px;
      border-top: 1px solid #f2f4fb;
      font-size: 14px;
    }

    .vote-row:first-child {
      border-top: none;
    }

    .vote-main {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .vote-pill {
      padding: 3px 9px;
      border-radius: 999px;
      font-size: 11px;
      border: 1px solid #e0e7f3;
      background: #f7f9ff;
      color: #f52b01;
    }

    .your-vote-pill {
      background: #c8e6c9;
      border-color: #81c784;
      color: #1b5e20;
    }

    .vote-button {
      min-width: 86px;
    }

    .admin-note {
      font-size: 13px;
      margin-bottom: 8px;
      color: var(--text-muted);
    }

    .remove-button {
      font-size: 12px;
      padding: 4px 10px;
    }

    .login-panel {
      max-width: 420px;
      margin-top: 4px;
      margin-bottom: 4px;
      padding: 16px 16px 18px 16px;
      border-radius: 16px;
      background: radial-gradient(circle at top left, #ffffff 0, #f3f7ff 55%, #eaf1ff 100%);
      border: 1px solid #e0e7f5;
      box-shadow: 0 10px 28px rgba(15,32,60,0.1);
    }

    .field {
      margin-bottom: 10px;
    }

    .field label {
      display: block;
      font-size: 13px;
      margin-bottom: 4px;
    }

    .field input {
      width: 100%;
      border-radius: 999px;
      border: 1px solid #cfd8e3;
      padding: 8px 12px;
      font-size: 14px;
      outline: none;
      transition: border-color 0.16s ease, box-shadow 0.16s ease, background 0.16s ease;
      background: #ffffff;
    }

    .field input:focus {
      border-color: #007cc0;
      box-shadow: 0 0 0 3px rgba(0,124,192,0.15);
      background: #f7fbff;
    }

    .login-actions {
      margin-top: 8px;
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .hint {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 6px;
    }

    footer {
      margin-top: 18px;
      font-size: 12px;
      text-align: center;
      color: var(--text-muted);
      text-shadow: 0 1px 0 #ffffff;
      position: relative;
      padding-top: 10px;
    }

    footer::before {
      content: "";
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 260px;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.95), transparent);
    }

    @media (max-width: 720px) {
      header {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }
      .header-right {
        align-items: flex-start;
      }
      .top-bar {
        flex-direction: column;
        align-items: flex-start;
      }
      .nav-tabs {
        width: 100%;
      }
    }

    .lang-switch {
      display: flex;
      gap: 4px;
    }

    .lang-btn {
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.7);
      background: rgba(255,255,255,0.15);
      color: #fff;
      font-size: 11px;
      padding: 2px 8px;
      cursor: pointer;
    }

    .lang-btn.active {
      background: #fff;
      color: #00558c;
    }
  </style>
</head>
<body>
  <main>
    <header>
      <div class="header-left">
        <div class="logo-circle"><span>LB</span></div>
        <div class="header-title">
          <h1>L√ÑMNE√Ö BRUK</h1>
          <span data-i18n="header_subtitle">
            Jultr√∂jet√§vling ‚Äì kall jullunch i verkstaden
          </span>
        </div>
      </div>
      <div class="header-right">
        <div class="login-status" id="login-status"></div>
        <div class="lang-switch">
          <button class="lang-btn active" data-lang="sv">SV</button>
          <button class="lang-btn" data-lang="en">EN</button>
        </div>
        <div class="xmas-label">
          <span class="emoji">‚ùÑÔ∏è</span>
          <span data-i18n="header_tagline">Byggd f√∂r en mysig jul p√• L√§mne√•</span>
        </div>
      </div>
    </header>

    <section class="card">
      <div class="top-bar" id="top-bar">
        <nav class="nav-tabs">
          <button class="nav-button active" data-view="home-view" id="tab-home">
            <span class="emoji">üè†</span>
            <span data-i18n="nav_start">Start</span>
          </button>
          <button class="nav-button" data-view="enter-view" id="tab-enter">
            <span class="emoji">üé´</span>
            <span data-i18n="nav_enter">Anm√§lan</span>
          </button>
          <button class="nav-button" data-view="vote-view" id="tab-vote">
            <span class="emoji">‚úÖ</span>
            <span data-i18n="nav_vote">R√∂sta</span>
          </button>
          <button class="nav-button" data-view="entries-view" id="tab-entries">
            <span class="emoji">üìä</span>
            <span data-i18n="nav_results">Bidrag &amp; resultat</span>
          </button>
        </nav>
        <div class="top-actions">
          <span id="logged-in-label"></span>
          <button class="button small secondary" id="btn-admin" data-i18n="admin_button">
            Admin
          </button>
          <button class="button small secondary" id="btn-logout" data-i18n="logout_button">
            Logga ut
          </button>
        </div>
      </div>

      <div class="info-banner" id="info-banner">
        <div class="bar"></div>
        <div data-i18n="info_banner_html">
          <strong>Anv√§nd knapparna ovan</strong> f√∂r att anm√§la dig, r√∂sta eller se vem som deltar. Data lagras
          lokalt i din webbl√§sare.
        </div>
      </div>

      <!-- Login view -->
      <section class="view" id="login-view">
        <h2 data-i18n="login_title">Logga in</h2>
        <p data-i18n="login_desc">
          Logga in med ditt <strong>anst√§llningsnummer</strong> f√∂r att kunna anm√§la dig eller r√∂sta.
        </p>
        <div class="login-panel">
          <div class="field">
            <label for="login-number" data-i18n="login_field_empno">Anst√§llningsnummer</label>
            <input type="number" id="login-number" autocomplete="off" />
          </div>
          <div class="login-actions">
            <button class="button" id="btn-login">
              <span data-i18n="login_button">Logga in</span>
            </button>
          </div>
          <div class="hint" data-i18n="login_hint">
            Ditt namn h√§mtas fr√•n L√§mne√• Bruks personallista.
          </div>
          <div class="message error" id="login-error" style="display:none;"></div>
        </div>
      </section>

      <!-- Home view -->
      <section class="view active" id="home-view">
        <h2 data-i18n="home_title">Start</h2>
        <p data-i18n="home_intro">
          V√§lkommen till L√§mne√• Bruks jultr√∂jet√§vling! Ta p√• dig din b√§sta jultr√∂ja och var med i en
          eller flera kategorier. Under lunchen r√∂star alla p√• sina favoriter. En vinnare per kategori.
        </p>

        <div class="home-grid">
          <div class="home-card">
            <div class="home-card-header">
              <div class="home-card-title">
                <span class="emoji">üéÅ</span>
                <span data-i18n="cat_creative_name">Mest kreativ</span>
              </div>
              <div class="home-card-badge" data-i18n="cat_creative_prize">
                Pris: Present med kreativt tema
              </div>
            </div>
            <p data-i18n="cat_creative_desc">
              F√∂r den mest originella, ov√§ntade eller roliga jultr√∂je-id√©n.
            </p>
          </div>

          <div class="home-card">
            <div class="home-card-header">
              <div class="home-card-title">
                <span class="emoji">üßµ</span>
                <span data-i18n="cat_craft_name">B√§sta hantverk</span>
              </div>
              <div class="home-card-badge" data-i18n="cat_craft_prize">
                Pris: Kvalitetsverktyg eller gadget
              </div>
            </div>
            <p data-i18n="cat_craft_desc">
              F√∂r tr√∂jor med imponerande detaljer, handgjorda till√§gg eller extra mycket jobb.
            </p>
          </div>

          <div class="home-card">
            <div class="home-card-header">
              <div class="home-card-title">
                <span class="emoji">üéÑ</span>
                <span data-i18n="cat_festive_name">Mest julig</span>
              </div>
              <div class="home-card-badge" data-i18n="cat_festive_prize">
                Pris: Julig √∂verraskning
              </div>
            </div>
            <p data-i18n="cat_festive_desc">
              F√∂r tr√∂jor som ger den starkaste julk√§nslan ‚Äì f√§rg, glitter eller lampor.
            </p>
          </div>
        </div>
      </section>

      <!-- Enter view -->
      <section class="view" id="enter-view">
        <h2 data-i18n="enter_title">Anm√§l dig till jultr√∂jet√§vlingen</h2>
        <p data-i18n="enter_desc">
          V√§lj en kategori nedan. Du kan anm√§la dig en g√•ng per kategori. Ditt namn syns i listan √∂ver deltagare.
        </p>

        <div class="status-text">
          <span data-i18n="enter_status_prefix">Du √§r anm√§ld i: </span>
          <span id="enter-status"></span>
        </div>

        <div class="category-chips" id="enter-category-chips"></div>

        <div class="message" id="enter-message"></div>

        <div style="margin-top:12px; display:flex; flex-wrap:wrap; gap:8px;">
          <button class="button small" id="btn-enter-confirm" data-i18n="enter_btn_confirm">
            Bekr√§fta anm√§lan
          </button>
          <button class="button small secondary" id="btn-leave-category" data-i18n="enter_btn_leave">
            L√§mna vald kategori
          </button>
          <button class="button small secondary" id="btn-enter-back" data-i18n="enter_btn_back">
            Tillbaka till start
          </button>
        </div>
      </section>

      <!-- Vote view -->
      <section class="view" id="vote-view">
        <h2 data-i18n="vote_title">R√∂sta</h2>
        <p data-i18n="vote_info">
          Du f√•r r√∂sta en g√•ng per kategori. Du kan inte r√∂sta p√• dig sj√§lv. Klicka p√• ett bidrag
          f√∂r att r√∂sta ‚Äì klicka igen f√∂r att ta bort din r√∂st.
        </p>

        <div class="category-chips" id="vote-category-chips"></div>

        <div class="message" id="vote-message"></div>

        <div class="vote-list" id="vote-list"></div>

        <div style="margin-top:12px;">
          <button class="button small secondary" id="btn-vote-back" data-i18n="vote_btn_back">
            Tillbaka till start
          </button>
        </div>
      </section>

      <!-- Entries & results view -->
      <section class="view" id="entries-view">
        <h2 data-i18n="results_title">Bidrag &amp; resultat</h2>
        <p data-i18n="results_info">
          H√§r kan du se vem som deltar i varje kategori och hur m√•nga r√∂ster varje bidrag f√•tt.
        </p>

        <div id="entries-sections"></div>

        <div style="margin-top:12px;">
          <button class="button small secondary" id="btn-entries-back" data-i18n="results_btn_back">
            Tillbaka till start
          </button>
        </div>
      </section>

      <!-- Admin view -->
      <section class="view" id="admin-view">
          <h2 data-i18n="admin_title">Admin ‚Äì hantera deltagare</h2>
          <p class="admin-note" data-i18n="admin_info">
              H√§r kan du ta bort deltagare per kategori. Alla r√∂ster p√• borttagna bidrag rensas.
          </p>

          <!-- Voting lock controls -->
          <p class="admin-note" id="admin-vote-lock-status"></p>
          <div style="margin:4px 0 12px 0; display:flex; flex-wrap:wrap; gap:8px;">
              <button class="button small" id="btn-toggle-vote-lock">
                  <!-- text s√§tts i JS -->
              </button>
          </div>

          <!-- NYTT: export/import-kontroller -->
          <p class="admin-note" data-i18n="admin_export_info">
              Exportera eller importera alla anm√§lningar, r√∂ster och r√∂stningsl√§ge.
          </p>
          <div style="margin:4px 0 8px 0; display:flex; flex-wrap:wrap; gap:8px;">
              <button class="button small secondary" id="btn-export-data" data-i18n="admin_export_btn">
                  Exportera data (JSON)
              </button>
              <button class="button small secondary" id="btn-import-data" data-i18n="admin_import_btn">
                  Importera data (JSON)
              </button>
              <input type="file" id="import-file" accept="application/json" style="display:none;" />
          </div>
          <div class="message" id="admin-export-message"></div>
          <!-- SLUT NYTT -->

          <div id="admin-sections"></div>


          <div style="margin-top:12px;">
              <button class="button small secondary" id="btn-admin-back" data-i18n="admin_btn_back">
                  Tillbaka till start
              </button>
          </div>
      </section>

      <footer data-i18n="footer_text">
        Data lagras lokalt i din webbl√§sare. Byggd f√∂r L√§mne√• Bruk Christmas Sweater Competition.
      </footer>
    </section>
  </main>

  <script>
    // ---------- TEXTER / STRINGS ----------

    const STRINGS = {
      sv: {
        header_tagline: "Byggd f√∂r en mysig jul p√• L√§mne√•",
        header_subtitle: "Jultr√∂jet√§vling ‚Äì kall jullunch i verkstaden",

        nav_start: "Start",
        nav_enter: "Anm√§lan",
        nav_vote: "R√∂sta",
        nav_results: "Bidrag & resultat",

        admin_button: "Admin",
        logout_button: "Logga ut",

        login_status_not: "Inte inloggad",
        login_status_label: "Inloggad som: {NAME} (Nr {ID})",

        info_banner_html:
          "<strong>Anv√§nd knapparna ovan</strong> f√∂r att anm√§la dig, r√∂sta eller se vem som deltar. Data lagras lokalt i din webbl√§sare.",

        login_title: "Logga in",
        login_desc:
          "Logga in med ditt <strong>anst√§llningsnummer</strong> f√∂r att kunna anm√§la dig eller r√∂sta.",
        login_field_empno: "Anst√§llningsnummer",
        login_button: "Logga in",
        login_hint: "Ditt namn h√§mtas fr√•n L√§mne√• Bruks personallista.",
        login_error_empty: "Fyll i ditt anst√§llningsnummer.",
        login_error_invalid: "Fyll i ett giltigt anst√§llningsnummer.",
        login_error_notfound: "Hittar ingen anst√§lld med det numret.",

        home_title: "Start",
        home_intro:
          "V√§lkommen till L√§mne√• Bruks jultr√∂jet√§vling! Ta p√• dig din b√§sta jultr√∂ja och var med i en eller flera kategorier. Under lunchen r√∂star alla p√• sina favoriter. En vinnare per kategori.",

        cat_creative_name: "Mest kreativ",
        cat_creative_prize: "Pris: Present med kreativt tema",
        cat_creative_desc: "F√∂r den mest originella, ov√§ntade eller roliga jultr√∂je-id√©n.",

        cat_craft_name: "B√§sta hantverk",
        cat_craft_prize: "Pris: Kvalitetsverktyg eller gadget",
        cat_craft_desc:
          "F√∂r tr√∂jor med imponerande detaljer, handgjorda till√§gg eller extra mycket jobb.",

        cat_festive_name: "Mest julig",
        cat_festive_prize: "Pris: Julig √∂verraskning",
        cat_festive_desc:
          "F√∂r tr√∂jor som ger den starkaste julk√§nslan ‚Äì f√§rg, glitter eller lampor.",

        enter_title: "Anm√§l dig till jultr√∂jet√§vlingen",
        enter_desc:
          "V√§lj en kategori nedan. Du kan anm√§la dig en g√•ng per kategori. Ditt namn syns i listan √∂ver deltagare.",
        enter_status_prefix: "Du √§r anm√§ld i: ",
        enter_status_none: "Ingen kategori √§nnu",
        enter_btn_confirm: "Bekr√§fta anm√§lan",
        enter_btn_leave: "L√§mna vald kategori",
        enter_btn_back: "Tillbaka till start",
        enter_msg_already_in: 'Du √§r redan anm√§ld i "{CATEGORY}".',
        enter_msg_registered: 'Du √§r nu anm√§ld i "{CATEGORY}".',
        enter_msg_not_in: 'Du √§r inte anm√§ld i "{CATEGORY}".',
        enter_confirm_prompt:
          "F√∂r att l√§mna den h√§r kategorin, bekr√§fta ditt anst√§llningsnummer:",
        enter_confirm_mismatch:
          "Anst√§llningsnumret st√§mde inte. Ingen √§ndring gjordes.",
        enter_msg_left: 'Du har l√§mnat "{CATEGORY}".',

        vote_title: "R√∂sta",
        vote_info:
          "Du f√•r r√∂sta en g√•ng per kategori. Du kan inte r√∂sta p√• dig sj√§lv. Klicka p√• ett bidrag f√∂r att r√∂sta ‚Äì klicka igen f√∂r att ta bort din r√∂st.",
        vote_no_entries: "Det finns inga andra deltagare i den h√§r kategorin √§nnu.",
        vote_btn_back: "Tillbaka till start",
        vote_status_removed: "Din r√∂st i denna kategori har tagits bort.",
        vote_status_recorded: 'Din r√∂st p√• "{NAME}" har registrerats.',

        vote_label_you_not_votable: "Du (kan inte r√∂stas p√•)",
        vote_label_entry: "Bidrag",
        vote_label_your_vote: "Din r√∂st",
        vote_button_not_allowed: "Inte till√•tet",
        vote_button_vote: "R√∂sta",
        vote_button_remove: "Ta bort r√∂st",
        vote_button_locked: "St√§ngd",
        vote_locked_message: "R√∂stningen √§r inte √∂ppen √§nnu. Kom tillbaka p√• r√∂stningsdagen!",

        results_title: "Bidrag & resultat",
        results_info:
          "H√§r kan du se vem som deltar i varje kategori och hur m√•nga r√∂ster varje bidrag f√•tt.",
        results_no_entries: "Det finns inga bidrag i den h√§r kategorin √§nnu.",
        results_tie: "Delad plats",
        results_votes_label: "R√∂ster: {COUNT}",
        results_btn_back: "Tillbaka till start",

        admin_title: "Admin ‚Äì hantera deltagare",
        admin_info:
          "H√§r kan du ta bort deltagare per kategori. Alla r√∂ster p√• borttagna bidrag rensas.",
        admin_btn_back: "Tillbaka till start",
        admin_no_entries: "Det finns inga bidrag i den h√§r kategorin √§nnu.",
        admin_remove_button: "Ta bort",
        admin_remove_confirm:
          'Ta bort "{NAME}" fr√•n "{CATEGORY}"? Alla r√∂ster p√• detta bidrag tas bort.',

              admin_export_info:
          "Exportera eller importera alla anm√§lningar, r√∂ster och r√∂stningsl√§ge. Filen kan sparas som backup eller flyttas till en annan dator.",
        admin_export_btn: "Exportera data (JSON)",
        admin_import_btn: "Importera data (JSON)",
        admin_export_success: "Data har exporterats ‚Äì en JSON-fil laddades ner.",
        admin_import_success:
          "Data har importerats. Anm√§lningar, r√∂ster och r√∂stningsl√§ge har uppdaterats.",
        admin_import_error:
          "Kunde inte l√§sa filen. Kontrollera att det √§r en giltig export-fil fr√•n jultr√∂jet√§vlingen.",

        admin_votelock_status_locked:
          "R√∂stning: ST√ÑNGD ‚Äì deltagarna kan inte r√∂sta just nu.",
        admin_votelock_status_open:
          "R√∂stning: √ñPPEN ‚Äì deltagarna kan r√∂sta i alla kategorier.",
        admin_votelock_btn_open: "√ñppna r√∂stning",
        admin_votelock_btn_close: "St√§ng r√∂stning",

        admin_code_prompt: "Ange admin-kod:",
        admin_code_incorrect: "Fel kod.",

        footer_text:
          "Data lagras lokalt i din webbl√§sare. Byggd f√∂r L√§mne√• Bruk Christmas Sweater Competition."
      },
      en: {
        header_tagline: "Built for a cosy L√§mne√• Christmas",
        header_subtitle: "Christmas Sweater Competition ‚Äì cold Christmas lunch in the workshop",

        nav_start: "Start",
        nav_enter: "Enter competition",
        nav_vote: "Vote",
        nav_results: "Entries & results",

        admin_button: "Admin",
        logout_button: "Log out",

        login_status_not: "Not logged in",
        login_status_label: "Logged in as: {NAME} (No. {ID})",

        info_banner_html:
          "<strong>Use the buttons above</strong> to enter the competition, cast your votes, or see who is participating. Data is stored locally in your browser.",

        login_title: "Log in",
        login_desc:
          "Please log in with your <strong>employee number</strong> to enter the competition or vote.",
        login_field_empno: "Employee number",
        login_button: "Log in",
        login_hint: "Your name will be looked up from the L√§mne√• Bruk staff list.",
        login_error_empty: "Please enter your employee number.",
        login_error_invalid: "Please enter a valid employee number.",
        login_error_notfound: "No employee found with that number.",

        home_title: "Start",
        home_intro:
          "Welcome to the L√§mne√• Bruk Christmas Sweater Competition! Dress up in your best Christmas sweater and join one or more categories. During the lunch, everyone can vote for their favourites. One winner per category.",

        cat_creative_name: "Most Creative",
        cat_creative_prize: "Prize: Creative-themed gift",
        cat_creative_desc:
          "For the most original, unexpected or fun Christmas sweater idea.",

        cat_craft_name: "Best Craftsmanship",
        cat_craft_prize: "Prize: Quality tool or gadget",
        cat_craft_desc:
          "For sweaters with impressive details, handmade additions or extra effort.",

        cat_festive_name: "Most Festive",
        cat_festive_prize: "Prize: Festive Christmas surprise",
        cat_festive_desc:
          "For sweaters that bring out the strongest Christmas feeling ‚Äì colour, glitter or lights.",

        enter_title: "Enter the Christmas Sweater Competition",
        enter_desc:
          "Choose a category below to participate. You may enter once per category. Your name will be shown in the list of participants.",
        enter_status_prefix: "You are registered in: ",
        enter_status_none: "None yet",
        enter_btn_confirm: "Confirm entry",
        enter_btn_leave: "Leave selected category",
        enter_btn_back: "Back to start",
        enter_msg_already_in: 'You are already entered in "{CATEGORY}".',
        enter_msg_registered: 'You are now registered in "{CATEGORY}".',
        enter_msg_not_in: 'You are not registered in "{CATEGORY}".',
        enter_confirm_prompt:
          "To leave this category, please confirm your employee number:",
        enter_confirm_mismatch:
          "Employee number did not match. No changes were made.",
        enter_msg_left: 'You have left "{CATEGORY}".',

        vote_title: "Vote",
        vote_info:
          "You may vote once per category. You cannot vote for yourself. Click on an entry to vote ‚Äì click again to remove your vote.",
        vote_no_entries: "No other entries in this category yet.",
        vote_btn_back: "Back to start",
        vote_status_removed: "Your vote in this category has been removed.",
        vote_status_recorded: 'Your vote for "{NAME}" has been recorded.',

        vote_label_you_not_votable: "You (not votable)",
        vote_label_entry: "Entry",
        vote_label_your_vote: "Your vote",
        vote_button_not_allowed: "Not allowed",
        vote_button_vote: "Vote",
        vote_button_remove: "Remove",
        vote_button_locked: "Closed",
        vote_locked_message: "Voting is not open yet. Please come back on the voting day!",

        results_title: "Entries & results",
        results_info:
          "Here you can see who is participating in each category and how many votes each entry has received on this device.",
        results_no_entries: "No entries in this category yet.",
        results_tie: "Tie",
        results_votes_label: "Votes: {COUNT}",
        results_btn_back: "Back to start",

        admin_title: "Admin ‚Äì manage entries",
        admin_info:
          "This view is for admins only. You can remove participants from categories. Votes for a removed entry will also be cleared.",
        admin_btn_back: "Back to start",
        admin_no_entries: "No entries in this category yet.",
        admin_remove_button: "Remove",
        admin_remove_confirm:
          'Remove "{NAME}" from "{CATEGORY}"? All votes for this entry will be cleared.',

              admin_export_info:
          "Export or import all entries, votes and the voting lock state. Use this file as a backup or move the data to another computer.",
        admin_export_btn: "Export data (JSON)",
        admin_import_btn: "Import data (JSON)",
        admin_export_success: "Data exported ‚Äì a JSON file was downloaded.",
        admin_import_success:
          "Data imported. Entries, votes and voting lock state have been updated.",
        admin_import_error:
          "Could not read the file. Please make sure it is a valid export file from the sweater competition.",

        admin_votelock_status_locked:
          "Voting: CLOSED ‚Äì participants cannot vote right now.",
        admin_votelock_status_open:
          "Voting: OPEN ‚Äì participants can vote in all categories.",
        admin_votelock_btn_open: "Open voting",
        admin_votelock_btn_close: "Close voting",

        admin_code_prompt: "Enter admin code:",
        admin_code_incorrect: "Incorrect code.",

        footer_text:
          "Data is stored locally in your browser. Built for L√§mne√• Bruk Christmas Sweater Competition."
      }
    };

    // ---------- HJ√ÑLPFUNKTION F√ñR √ñVERS√ÑTTNING ----------

    let currentLanguage = localStorage.getItem("lb_lang") || "sv";

    function t(key, vars = {}) {
      let s = STRINGS[currentLanguage][key] || "";
      Object.keys(vars).forEach(k => {
        s = s.replace("{" + k + "}", vars[k]);
      });
      return s;
    }

    function applyLanguage(lang) {
      currentLanguage = lang;
      localStorage.setItem("lb_lang", lang);
      document.documentElement.lang = lang;

      document.querySelectorAll("[data-i18n]").forEach(el => {
        const key = el.getAttribute("data-i18n");
        const str = STRINGS[lang][key];
        if (str !== undefined) {
          el.innerHTML = str;
        }
      });

      document.querySelectorAll(".lang-btn").forEach(btn => {
        btn.classList.toggle("active", btn.getAttribute("data-lang") === lang);
      });

      updateLoginStatus();
      updateEnterStatus();
      renderEnterCategoryChips();
      renderVoteCategoryChips();
      renderVoteList();
      renderEntriesView();
      renderAdminView();
      updateVoteLockUI();
      updateVoteLockMessage();
    }

    // ---------- DATA (anst√§llda & kategorier) ----------

    const EMPLOYEES = [
      {"employeeId":7,"firstName":"Anders","lastName":"Turesson","displayName":"Anders Turesson"},
      {"employeeId":12,"firstName":"Benny","lastName":"Olofsson","displayName":"Benny Olofsson"},
      {"employeeId":18,"firstName":"Johan","lastName":"Wincent","displayName":"Johan Wincent"},
      {"employeeId":25,"firstName":"Mattias","lastName":"Kratz","displayName":"Mattias Kratz"},
      {"employeeId":40,"firstName":"Magnus","lastName":"Hellqvist","displayName":"Magnus Hellqvist"},
      {"employeeId":43,"firstName":"Olav","lastName":"Lindholm","displayName":"Olav Lindholm"},
      {"employeeId":44,"firstName":"Mats","lastName":"Lindholm","displayName":"Mats Lindholm"},
      {"employeeId":46,"firstName":"Jimmy","lastName":"Berg","displayName":"Jimmy Berg"},
      {"employeeId":84,"firstName":"Sven-Erik","lastName":"Medin","displayName":"Sven-Erik Medin"},
      {"employeeId":96,"firstName":"Daniel","lastName":"Hellqvist","displayName":"Daniel Hellqvist"},
      {"employeeId":100,"firstName":"Jonas","lastName":"Hagstedt","displayName":"Jonas Hagstedt"},
      {"employeeId":111,"firstName":"Peter","lastName":"Jansson","displayName":"Peter Jansson"},
      {"employeeId":113,"firstName":"Stefan","lastName":"Petersson","displayName":"Stefan Petersson"},
      {"employeeId":119,"firstName":"Per","lastName":"Odhe","displayName":"Per Odhe"},
      {"employeeId":121,"firstName":"Daniel","lastName":"Malteskog","displayName":"Daniel Malteskog"},
      {"employeeId":132,"firstName":"Thorbj√∂rn","lastName":"Gustafsson","displayName":"Thorbj√∂rn Gustafsson"},
      {"employeeId":134,"firstName":"Mats","lastName":"Rangsj√∂","displayName":"Mats Rangsj√∂"},
      {"employeeId":144,"firstName":"Jessica","lastName":"Zeijlon","displayName":"Jessica Zeijlon"},
      {"employeeId":148,"firstName":"Mathilda","lastName":"Hagstedt Suorra","displayName":"Mathilda Hagstedt Suorra"},
      {"employeeId":183,"firstName":"Jonas","lastName":"Walfridsson","displayName":"Jonas Walfridsson"},
      {"employeeId":184,"firstName":"Peder","lastName":"Helgesson","displayName":"Peder Helgesson"},
      {"employeeId":186,"firstName":"Mikael","lastName":"Zeijlon","displayName":"Mikael Zeijlon"},
      {"employeeId":187,"firstName":"Roger","lastName":"Pettersson","displayName":"Roger Pettersson"},
      {"employeeId":188,"firstName":"Andreas","lastName":"Johansson","displayName":"Andreas Johansson"},
      {"employeeId":191,"firstName":"Elin","lastName":"Arnemyr Nyberg","displayName":"Elin Arnemyr Nyberg"},
      {"employeeId":193,"firstName":"Jacob","lastName":"Markstr√∂m","displayName":"Jacob Markstr√∂m"},
      {"employeeId":202,"firstName":"Gustav","lastName":"Larsson","displayName":"Gustav Larsson"},
      {"employeeId":205,"firstName":"Peter","lastName":"Lyberg","displayName":"Peter Lyberg"},
      {"employeeId":207,"firstName":"Tore","lastName":"Andersson","displayName":"Tore Andersson"},
      {"employeeId":210,"firstName":"Andreas","lastName":"Wennstr√∂m","displayName":"Andreas Wennstr√∂m"},
      {"employeeId":216,"firstName":"Erik","lastName":"Johansson","displayName":"Erik Johansson"},
      {"employeeId":232,"firstName":"Niklas","lastName":"Gustafsson","displayName":"Niklas Gustafsson"},
      {"employeeId":250,"firstName":"Christoffer","lastName":"Andersson","displayName":"Christoffer Andersson"},
      {"employeeId":255,"firstName":"Anna","lastName":"Johansson","displayName":"Anna Johansson"},
      {"employeeId":260,"firstName":"Amanda","lastName":"Mesch","displayName":"Amanda Mesch"},
      {"employeeId":273,"firstName":"Dennis","lastName":"Drewniok","displayName":"Dennis Drewniok"},
      {"employeeId":274,"firstName":"Simon","lastName":"Karlsson","displayName":"Simon Karlsson"},
      {"employeeId":277,"firstName":"Ann Kathrin","lastName":"Hassenburs","displayName":"Ann Kathrin Hassenburs"},
      {"employeeId":278,"firstName":"Viktor","lastName":"Svensson","displayName":"Viktor Svensson"},
      {"employeeId":285,"firstName":"Jonathan","lastName":"Danborg Tammelin","displayName":"Jonathan Danborg Tammelin"},
      {"employeeId":286,"firstName":"Teddie","lastName":"Hultmark","displayName":"Teddie Hultmark"},
      {"employeeId":291,"firstName":"Johanna","lastName":"Ahlfors","displayName":"Johanna Ahlfors"},
      {"employeeId":294,"firstName":"Deaz","lastName":"N√§slund","displayName":"Deaz N√§slund"},
      {"employeeId":297,"firstName":"Emelie","lastName":"Lyberg","displayName":"Emelie Lyberg"},
      {"employeeId":304,"firstName":"Isak","lastName":"Sundkvist","displayName":"Isak Sundkvist"},
      {"employeeId":311,"firstName":"√Ångel","lastName":"Belmonte","displayName":"√Ångel Belmonte"},
      {"employeeId":313,"firstName":"Borys","lastName":"Ovsyannykov","displayName":"Borys Ovsyannykov"},
      {"employeeId":315,"firstName":"Mattias","lastName":"Lindh","displayName":"Mattias Lindh"},
      {"employeeId":316,"firstName":"Magnus","lastName":"Mj√§rdner","displayName":"Magnus Mj√§rdner"},
      {"employeeId":332,"firstName":"Elena","lastName":"Burdyuzha","displayName":"Elena Burdyuzha"},
      {"employeeId":336,"firstName":"Melker","lastName":"Vetel√§inen","displayName":"Melker Vetel√§inen"},
      {"employeeId":338,"firstName":"Martin","lastName":"Kvilleng","displayName":"Martin Kvilleng"},
      {"employeeId":340,"firstName":"Erik","lastName":"Hagstedt","displayName":"Erik Hagstedt"},
      {"employeeId":341,"firstName":"John","lastName":"Lindh","displayName":"John Lindh"},
      {"employeeId":346,"firstName":"Olga","lastName":"Ovsiannykova","displayName":"Olga Ovsiannykova"},
      {"employeeId":348,"firstName":"Simon","lastName":"Klasson","displayName":"Simon Klasson"},
      {"employeeId":352,"firstName":"Michael","lastName":"Lundberg","displayName":"Michael Lundberg"},
      {"employeeId":353,"firstName":"Christoffer","lastName":"Fransson","displayName":"Christoffer Fransson"},
      {"employeeId":365,"firstName":"Johanna","lastName":"T√∂rnfeldt","displayName":"Johanna T√∂rnfeldt"},
      {"employeeId":366,"firstName":"Joachim","lastName":"Rinaldo","displayName":"Joachim Rinaldo"},
      {"employeeId":369,"firstName":"Kerstin","lastName":"Gustafsson Markos","displayName":"Kerstin Gustafsson Markos"},
      {"employeeId":374,"firstName":"Mihai","lastName":"Pana","displayName":"Mihai Pana"},
      {"employeeId":381,"firstName":"Dan Stefan","lastName":"T√∂t√∂s","displayName":"Dan Stefan T√∂t√∂s"},
      {"employeeId":383,"firstName":"Daniel","lastName":"Nordqvist","displayName":"Daniel Nordqvist"},
      {"employeeId":384,"firstName":"Oskar","lastName":"Brandell","displayName":"Oskar Brandell"},
      {"employeeId":385,"firstName":"Rickard","lastName":"Sj√∂holm","displayName":"Rickard Sj√∂holm"},
      {"employeeId":391,"firstName":"Rasmus","lastName":"Moberg","displayName":"Rasmus Moberg"},
      {"employeeId":394,"firstName":"Ronny","lastName":"Olofsson","displayName":"Ronny Olofsson"},
      {"employeeId":395,"firstName":"Mikael","lastName":"Lej√•ker","displayName":"Mikael Lej√•ker"},
      {"employeeId":398,"firstName":"Joel","lastName":"Rikardsson","displayName":"Joel Rikardsson"},
      {"employeeId":399,"firstName":"Ebba","lastName":"Jorhammar","displayName":"Ebba Jorhammar"},
      {"employeeId":400,"firstName":"Emelie","lastName":"Dacke","displayName":"Emelie Dacke"},
      {"employeeId":402,"firstName":"Daniel","lastName":"Widlund","displayName":"Daniel Widlund"},
      {"employeeId":404,"firstName":"Marcus","lastName":"Wiberg","displayName":"Marcus Wiberg"},
      {"employeeId":405,"firstName":"Therese","lastName":"Malmsten","displayName":"Therese Malmsten"},
      {"employeeId":406,"firstName":"Pelle","lastName":"Sj√∂v√•g","displayName":"Pelle Sj√∂v√•g"},
      {"employeeId":407,"firstName":"Linus","lastName":"Brandell","displayName":"Linus Brandell"},
      {"employeeId":411,"firstName":"Tony","lastName":"Kardell","displayName":"Tony Kardell"},
      {"employeeId":415,"firstName":"Emrik","lastName":"Ekholm","displayName":"Emrik Ekholm"},
      {"employeeId":416,"firstName":"Alfons","lastName":"Hultmark","displayName":"Alfons Hultmark"},
      {"employeeId":418,"firstName":"Jobayer","lastName":"Syed","displayName":"Jobayer Syed"},
      {"employeeId":421,"firstName":"Laurentiu","lastName":"Carausu","displayName":"Laurentiu Carausu"},
      {"employeeId":422,"firstName":"Mariia","lastName":"Puris","displayName":"Mariia Puris"},
      {"employeeId":423,"firstName":"Edith","lastName":"Helgesson","displayName":"Edith Helgesson"},
      {"employeeId":424,"firstName":"Caio","lastName":"Souza Persson","displayName":"Caio Souza Persson"},
      {"employeeId":425,"firstName":"Abdinasir","lastName":"Mohamed","displayName":"Abdinasir Mohamed"},
      {"employeeId":429,"firstName":"Fadi","lastName":"Al Satouf","displayName":"Fadi Al Satouf"},
      {"employeeId":430,"firstName":"Jesper","lastName":"Mellberg","displayName":"Jesper Mellberg"},
      {"employeeId":431,"firstName":"Wilhelm","lastName":"Log","displayName":"Wilhelm Log"},
      {"employeeId":433,"firstName":"Bagher","lastName":"Rasoli","displayName":"Bagher Rasoli"},
      {"employeeId":437,"firstName":"Emil","lastName":"Olsson Staf","displayName":"Emil Olsson Staf"},
      {"employeeId":440,"firstName":"Kenneth","lastName":"Carlsson","displayName":"Kenneth Carlsson"},
      {"employeeId":443,"firstName":"Daniela","lastName":"Negoita","displayName":"Daniela Negoita"},
      {"employeeId":447,"firstName":"Markus","lastName":"Gattermann","displayName":"Markus Gattermann"},
      {"employeeId":451,"firstName":"Mohammed","lastName":"Liban","displayName":"Mohammed Liban"},
      {"employeeId":459,"firstName":"Lill","lastName":"Landqvist","displayName":"Lill Landqvist"},
      {"employeeId":461,"firstName":"Jonas","lastName":"Karlsson","displayName":"Jonas Karlsson"},
      {"employeeId":462,"firstName":"Melvin","lastName":"Kratz","displayName":"Melvin Kratz"},
      {"employeeId":463,"firstName":"Josefin","lastName":"Fr√∂derberg Suorra","displayName":"Josefin Fr√∂derberg Suorra"},
      {"employeeId":465,"firstName":"Amina","lastName":"Sankoh","displayName":"Amina Sankoh"},
      {"employeeId":466,"firstName":"Sukaina","lastName":"Al-Azzawi","displayName":"Sukaina Al-Azzawi"},
      {"employeeId":470,"firstName":"Albin","lastName":"Harrysson","displayName":"Albin Harrysson"},
      {"employeeId":474,"firstName":"Erik","lastName":"Joelsson","displayName":"Erik Joelsson"},
      {"employeeId":475,"firstName":"Abdriahman","lastName":"Osman","displayName":"Abdriahman Osman"},
      {"employeeId":476,"firstName":"Robin","lastName":"Henriksson","displayName":"Robin Henriksson"},
      {"employeeId":478,"firstName":"Petter","lastName":"Osen","displayName":"Petter Osen"},
      {"employeeId":479,"firstName":"Greger","lastName":"Johansson","displayName":"Greger Johansson"},
      {"employeeId":481,"firstName":"Terry","lastName":"Stradling","displayName":"Terry Stradling"},
      {"employeeId":484,"firstName":"Olga","lastName":"Gerasimova","displayName":"Olga Gerasimova"},
      {"employeeId":493,"firstName":"Jan","lastName":"Sandberg","displayName":"Jan Sandberg"},
      {"employeeId":496,"firstName":"Kristoffer","lastName":"Lilja","displayName":"Kristoffer Lilja"},
      {"employeeId":498,"firstName":"Mohamad","lastName":"Farah","displayName":"Mohamad Farah"},
      {"employeeId":499,"firstName":"Ann-Christine","lastName":"Olsson","displayName":"Ann-Christine Olsson"},
      {"employeeId":500,"firstName":"Arvid","lastName":"Eriksson","displayName":"Arvid Eriksson"},
      {"employeeId":503,"firstName":"Molly","lastName":"Jernstr√∂m","displayName":"Molly Jernstr√∂m"},
      {"employeeId":504,"firstName":"Jonas","lastName":"M√•nsson","displayName":"Jonas M√•nsson"},
      {"employeeId":505,"firstName":"Hugo","lastName":"Persson","displayName":"Hugo Persson"},
      {"employeeId":508,"firstName":"Magnus","lastName":"B√§ckman","displayName":"Magnus B√§ckman"},
      {"employeeId":509,"firstName":"Maria","lastName":"Eriksson","displayName":"Maria Eriksson"},
      {"employeeId":510,"firstName":"Madeleine","lastName":"Gr√∂nborg","displayName":"Madeleine Gr√∂nborg"},
      {"employeeId":515,"firstName":"Samuel","lastName":"Nilsson","displayName":"Samuel Nilsson"},
      {"employeeId":517,"firstName":"Patrik","lastName":"Svensson","displayName":"Patrik Svensson"},
      {"employeeId":518,"firstName":"Albin","lastName":"Helgesson","displayName":"Albin Helgesson"},
      {"employeeId":521,"firstName":"Emma","lastName":"Olsson","displayName":"Emma Olsson"},
      {"employeeId":522,"firstName":"Kenneth","lastName":"Matlhole","displayName":"Kenneth Matlhole"},
      {"employeeId":523,"firstName":"Sabina","lastName":"Lindh","displayName":"Sabina Lindh"},
      {"employeeId":524,"firstName":"Emil","lastName":"Markberger","displayName":"Emil Markberger"},
      {"employeeId":526,"firstName":"Zandra","lastName":"Vastesson","displayName":"Zandra Vastesson"},
      {"employeeId":529,"firstName":"Andreas","lastName":"Henriksson","displayName":"Andreas Henriksson"},
      {"employeeId":530,"firstName":"Vilmer","lastName":"Hast","displayName":"Vilmer Hast"},
      {"employeeId":532,"firstName":"Henrik","lastName":"Fridh","displayName":"Henrik Fridh"},
      {"employeeId":534,"firstName":"Oliver","lastName":"Liljeqvist","displayName":"Oliver Liljeqvist"},
      {"employeeId":535,"firstName":"Mohammad","lastName":"Omar","displayName":"Mohammad Omar"},
      {"employeeId":536,"firstName":"Abdulwahid","lastName":"Tamam","displayName":"Abdulwahid Tamam"},
      {"employeeId":537,"firstName":"Armando","lastName":"Demirovic","displayName":"Armando Demirovic"},
      {"employeeId":1006,"firstName":"Bengt","lastName":"Andersson","displayName":"Bengt Andersson"},
      {"employeeId":1056,"firstName":"Bertil","lastName":"Pettersson","displayName":"Bertil Pettersson"},
      {"employeeId":1193,"firstName":"G√∂ran","lastName":"Persson","displayName":"G√∂ran Persson"},
      {"employeeId":1532,"firstName":"Vasile","lastName":"Iclanzan","displayName":"Vasile Iclanzan"},
      {"employeeId":1543,"firstName":"Richard","lastName":"Kovac","displayName":"Richard Kovac"},
      {"employeeId":1678,"firstName":"Dorin","lastName":"Cararus","displayName":"Dorin Cararus"},
      {"employeeId":1709,"firstName":"Jozef","lastName":"Bog√°r","displayName":"Jozef Bog√°r"},
      {"employeeId":1727,"firstName":"Darius","lastName":"Miclea","displayName":"Darius Miclea"},
      {"employeeId":1733,"firstName":"Love","lastName":"Lotusvik","displayName":"Love Lotusvik"},
      {"employeeId":1748,"firstName":"Peter","lastName":"Frank","displayName":"Peter Frank"},
      {"employeeId":1749,"firstName":"Sadek","lastName":"Khalidi","displayName":"Sadek Khalidi"},
      {"employeeId":1750,"firstName":"Erika","lastName":"Werme","displayName":"Erika Werme"},
      {"employeeId":1751,"firstName":"Niklas","lastName":"Ramstr√∂m","displayName":"Niklas Ramstr√∂m"},
      {"employeeId":1752,"firstName":"Robin","lastName":"Fransson","displayName":"Robin Fransson"},
      {"employeeId":1762,"firstName":"Petrus","lastName":"Ekstr√∂m","displayName":"Petrus Ekstr√∂m"},
      {"employeeId":1763,"firstName":"Timofej","lastName":"Iriminku","displayName":"Timofej Iriminku"},
      {"employeeId":1764,"firstName":"Filip","lastName":"Endal","displayName":"Filip Endal"},
      {"employeeId":1765,"firstName":"Erion","lastName":"Pacoli","displayName":"Erion Pacoli"},
      {"employeeId":1766,"firstName":"Andr√©","lastName":"Pettersson","displayName":"Andr√© Pettersson"},
      {"employeeId":1767,"firstName":"Hannes","lastName":"Oskarsson","displayName":"Hannes Oskarsson"},
      {"employeeId":7500,"firstName":"Jacob","lastName":"Hagstedt","displayName":"Jacob Hagstedt"},
      {"employeeId":7501,"firstName":"Samuel","lastName":"Eriksson","displayName":"Samuel Eriksson"},
      {"employeeId":7503,"firstName":"Jonas","lastName":"Hagstedt","displayName":"Jonas Hagstedt"},
      {"employeeId":7505,"firstName":"Thomas","lastName":"Ahlblom","displayName":"Thomas Ahlblom"},
      {"employeeId":7507,"firstName":"Noah","lastName":"Eriksson","displayName":"Noah Eriksson"},
      {"employeeId":7508,"firstName":"Manne","lastName":"Rydhe","displayName":"Manne Rydhe"},
      {"employeeId":7513,"firstName":"Eric","lastName":"Aidyn","displayName":"Eric Aidyn"},
      {"employeeId":7514,"firstName":"Hellen","lastName":"Karlsson","displayName":"Hellen Karlsson"},
      {"employeeId":7516,"firstName":"Joakim","lastName":"Holmgren","displayName":"Joakim Holmgren"}
    ];

    const CATEGORIES = [
      { id: "creative", icon: "üéÅ" },
      { id: "craft", icon: "üßµ" },
      { id: "festive", icon: "üéÑ" }
    ];

    function getCategoryLabel(catId) {
      if (catId === "creative") return t("cat_creative_name");
      if (catId === "craft") return t("cat_craft_name");
      if (catId === "festive") return t("cat_festive_name");
      return catId;
    }

    // ---------- LOKAL LAGRING ----------

    const STORAGE_KEYS = {
      entries: "lb_xmas_entries_v2",
      votes: "lb_xmas_votes_v2",
      currentUser: "lb_xmas_current_user_v2",
      isAdmin: "lb_xmas_is_admin_v2",
      voteLocked: "lb_xmas_vote_locked_v1"
    };

    function loadJson(key, fallback) {
      try {
        const raw = localStorage.getItem(key);
        if (!raw) return fallback;
        const parsed = JSON.parse(raw);
        if (Array.isArray(fallback) && !Array.isArray(parsed)) return fallback;
        return parsed;
      } catch {
        return fallback;
      }
    }

    function saveJson(key, value) {
      localStorage.setItem(key, JSON.stringify(value));
    }

    function loadVotingLock() {
      const raw = localStorage.getItem(STORAGE_KEYS.voteLocked);
      if (raw === null) return true; // default: r√∂stning l√•st
      return raw === "1";
    }

    function saveVotingLock() {
      localStorage.setItem(STORAGE_KEYS.voteLocked, votingLocked ? "1" : "0");
    }

    let entries = loadJson(STORAGE_KEYS.entries, []);
    let votes = loadJson(STORAGE_KEYS.votes, []);
    let currentUser = loadJson(STORAGE_KEYS.currentUser, null);
    let isAdmin = !!localStorage.getItem(STORAGE_KEYS.isAdmin);
    let votingLocked = loadVotingLock();

    function findEmployeeById(id) {
      return EMPLOYEES.find(e => e.employeeId === id);
    }

    // ---------- DOM-REFERENSER ----------

    const loginStatusEl = document.getElementById("login-status");
    const loggedInLabelEl = document.getElementById("logged-in-label");

    const loginView = document.getElementById("login-view");
    const homeView = document.getElementById("home-view");
    const enterView = document.getElementById("enter-view");
    const voteView = document.getElementById("vote-view");
    const entriesView = document.getElementById("entries-view");
    const adminView = document.getElementById("admin-view");

    const views = {
      "login-view": loginView,
      "home-view": homeView,
      "enter-view": enterView,
      "vote-view": voteView,
      "entries-view": entriesView,
      "admin-view": adminView
    };

    const navButtons = Array.from(document.querySelectorAll(".nav-button"));

    const enterStatusEl = document.getElementById("enter-status");
    const enterMessageEl = document.getElementById("enter-message");
    const enterCategoryChipsEl = document.getElementById("enter-category-chips");

    const voteCategoryChipsEl = document.getElementById("vote-category-chips");
    const voteMessageEl = document.getElementById("vote-message");
    const voteListEl = document.getElementById("vote-list");

    const entriesSectionsEl = document.getElementById("entries-sections");
    const adminSectionsEl = document.getElementById("admin-sections");

    const loginNumberInput = document.getElementById("login-number");
    const loginErrorEl = document.getElementById("login-error");

    const btnAdmin = document.getElementById("btn-admin");
    const btnLogout = document.getElementById("btn-logout");

    const btnEnterConfirm = document.getElementById("btn-enter-confirm");
    const btnLeaveCategory = document.getElementById("btn-leave-category");
    const btnEnterBack = document.getElementById("btn-enter-back");

    const btnVoteBack = document.getElementById("btn-vote-back");
    const btnEntriesBack = document.getElementById("btn-entries-back");
    const btnAdminBack = document.getElementById("btn-admin-back");

    const adminVoteLockStatusEl = document.getElementById("admin-vote-lock-status");
    const btnToggleVoteLock = document.getElementById("btn-toggle-vote-lock");

    // NYTT: export/import
    const btnExportData = document.getElementById("btn-export-data");
    const btnImportData = document.getElementById("btn-import-data");
    const importFileInput = document.getElementById("import-file");
    const adminExportMessageEl = document.getElementById("admin-export-message");


    let selectedEnterCategoryId = CATEGORIES[0].id;
    let selectedVoteCategoryId = CATEGORIES[0].id;

    // ---------- VY-HANTERING ----------

    function setView(viewId) {
      Object.values(views).forEach(v => v.classList.remove("active"));
      const v = views[viewId];
      if (v) v.classList.add("active");

      if (!currentUser && viewId !== "login-view") {
        loginView.classList.add("active");
      }

      navButtons.forEach(btn => {
        const target = btn.getAttribute("data-view");
        btn.classList.toggle("active", target === viewId);
      });

      if (viewId === "vote-view") {
        updateVoteLockMessage();
        renderVoteList();
      }
    }

    function updateLoginStatus() {
      if (!currentUser) {
        loginStatusEl.textContent = t("login_status_not");
        loggedInLabelEl.textContent = t("login_status_not");
      } else {
        const label = t("login_status_label", {
          NAME: currentUser.displayName,
          ID: currentUser.employeeId
        });
        loginStatusEl.textContent = label;
        loggedInLabelEl.textContent = label;
      }
    }

    function updateEnterStatus() {
      if (!currentUser) {
        enterStatusEl.textContent = t("enter_status_none");
        return;
      }
      const myCategories = entries
        .filter(e => e.employeeId === currentUser.employeeId)
        .map(e => getCategoryLabel(e.categoryId));

      if (myCategories.length === 0) {
        enterStatusEl.textContent = t("enter_status_none");
      } else {
        enterStatusEl.textContent = myCategories.join(", ");
      }
    }

    // ---------- R√ñST-L√ÖS UI ----------

    function updateVoteLockUI() {
      if (!adminVoteLockStatusEl || !btnToggleVoteLock) return;
      adminVoteLockStatusEl.textContent = votingLocked
        ? t("admin_votelock_status_locked")
        : t("admin_votelock_status_open");
      btnToggleVoteLock.textContent = votingLocked
        ? t("admin_votelock_btn_open")
        : t("admin_votelock_btn_close");
    }

    function updateVoteLockMessage() {
      if (!voteMessageEl) return;
      if (votingLocked) {
        voteMessageEl.textContent = t("vote_locked_message");
        voteMessageEl.className = "message";
      } else if (voteMessageEl.textContent === t("vote_locked_message")) {
        // t√∂m bara om den visade l√•s-meddelandet
        voteMessageEl.textContent = "";
        voteMessageEl.className = "message";
      }
    }

    // ---------- RENDERING: chips ----------

    function renderEnterCategoryChips() {
      enterCategoryChipsEl.innerHTML = "";
      CATEGORIES.forEach(cat => {
        const btn = document.createElement("button");
        btn.className =
          "category-chip" +
          (cat.id === selectedEnterCategoryId ? " selected" : "");
        btn.innerHTML =
          '<span class="icon">' +
          cat.icon +
          "</span><span>" +
          getCategoryLabel(cat.id) +
          "</span>";
        btn.addEventListener("click", () => {
          selectedEnterCategoryId = cat.id;
          renderEnterCategoryChips();
          enterMessageEl.textContent = "";
          enterMessageEl.className = "message";
        });
        enterCategoryChipsEl.appendChild(btn);
      });
    }

    function renderVoteCategoryChips() {
      voteCategoryChipsEl.innerHTML = "";
      CATEGORIES.forEach(cat => {
        const btn = document.createElement("button");
        btn.className =
          "category-chip" +
          (cat.id === selectedVoteCategoryId ? " selected" : "");
        btn.innerHTML =
          '<span class="icon">' +
          cat.icon +
          "</span><span>" +
          getCategoryLabel(cat.id) +
          "</span>";
        btn.addEventListener("click", () => {
          selectedVoteCategoryId = cat.id;
          renderVoteCategoryChips();
          renderVoteList();
          if (votingLocked) {
            updateVoteLockMessage();
          } else {
            voteMessageEl.textContent = "";
            voteMessageEl.className = "message";
          }
        });
        voteCategoryChipsEl.appendChild(btn);
      });
    }

    // ---------- ANM√ÑLAN ----------

    function handleEnterConfirm() {
      if (!currentUser) return;
      const catId = selectedEnterCategoryId;
      const existing = entries.find(
        e => e.employeeId === currentUser.employeeId && e.categoryId === catId
      );
      const catLabel = getCategoryLabel(catId);

      if (existing) {
        enterMessageEl.textContent = t("enter_msg_already_in", {
          CATEGORY: catLabel
        });
        enterMessageEl.className = "message";
        return;
      }

      entries.push({ employeeId: currentUser.employeeId, categoryId: catId });
      saveJson(STORAGE_KEYS.entries, entries);
      updateEnterStatus();
      enterMessageEl.textContent = t("enter_msg_registered", {
        CATEGORY: catLabel
      });
      enterMessageEl.className = "message success";
      renderVoteList();
      renderEntriesView();
      renderAdminView();
    }

    function handleLeaveCategory() {
      if (!currentUser) return;
      const catId = selectedEnterCategoryId;
      const catLabel = getCategoryLabel(catId);
      const existingIndex = entries.findIndex(
        e => e.employeeId === currentUser.employeeId && e.categoryId === catId
      );
      if (existingIndex === -1) {
        enterMessageEl.textContent = t("enter_msg_not_in", { CATEGORY: catLabel });
        enterMessageEl.className = "message";
        return;
      }

      const confirmNo = prompt(t("enter_confirm_prompt"));
      if (!confirmNo) return;
      const num = parseInt(confirmNo, 10);
      if (num !== currentUser.employeeId) {
        enterMessageEl.textContent = t("enter_confirm_mismatch");
        enterMessageEl.className = "message error";
        return;
      }

      const entry = entries[existingIndex];
      entries.splice(existingIndex, 1);

      votes = votes.filter(
        v => !(v.categoryId === catId && v.entryEmployeeId === entry.employeeId)
      );
      saveJson(STORAGE_KEYS.entries, entries);
      saveJson(STORAGE_KEYS.votes, votes);

      enterMessageEl.textContent = t("enter_msg_left", { CATEGORY: catLabel });
      enterMessageEl.className = "message success";
      updateEnterStatus();
      renderVoteList();
      renderEntriesView();
      renderAdminView();
    }

    // ---------- R√ñSTNING ----------

    function handleVote(categoryId, entryEmployeeId) {
      if (!currentUser) return;
      if (votingLocked) {
        updateVoteLockMessage();
        return;
      }

      const existingIndex = votes.findIndex(
        v => v.employeeId === currentUser.employeeId && v.categoryId === categoryId
      );

      if (existingIndex !== -1) {
        const existingVote = votes[existingIndex];
        if (existingVote.entryEmployeeId === entryEmployeeId) {
          votes.splice(existingIndex, 1);
          saveJson(STORAGE_KEYS.votes, votes);
          voteMessageEl.textContent = t("vote_status_removed");
          voteMessageEl.className = "message";
          renderVoteList();
          renderEntriesView();
          return;
        }
        existingVote.entryEmployeeId = entryEmployeeId;
      } else {
        votes.push({
          employeeId: currentUser.employeeId,
          categoryId: categoryId,
          entryEmployeeId: entryEmployeeId
        });
      }

      saveJson(STORAGE_KEYS.votes, votes);

      const votedFor = findEmployeeById(entryEmployeeId);
      const name = votedFor ? votedFor.displayName : entryEmployeeId;

      voteMessageEl.textContent = t("vote_status_recorded", { NAME: name });
      voteMessageEl.className = "message success";

      renderVoteList();
      renderEntriesView();
    }

    function renderVoteList() {
      voteListEl.innerHTML = "";
      if (!currentUser) return;
      const catId = selectedVoteCategoryId;

      const catEntries = entries
        .filter(e => e.categoryId === catId)
        .map(e => findEmployeeById(e.employeeId))
        .filter(Boolean)
        .sort((a, b) => a.displayName.localeCompare(b.displayName));

      const existingVote = votes.find(
        v => v.employeeId === currentUser.employeeId && v.categoryId === catId
      );

      if (catEntries.length === 0) {
        const div = document.createElement("div");
        div.className = "vote-row";
        div.textContent = t("vote_no_entries");
        voteListEl.appendChild(div);
        updateVoteLockMessage();
        return;
      }

      catEntries.forEach(emp => {
        const row = document.createElement("div");
        row.className = "vote-row";

        const main = document.createElement("div");
        main.className = "vote-main";

        const nameSpan = document.createElement("span");
        nameSpan.className = "entry-name";
        nameSpan.textContent = emp.displayName;

        const pillsContainer = document.createElement("div");
        const youLabel = document.createElement("span");
        youLabel.className = "vote-pill";
        youLabel.textContent =
          emp.employeeId === currentUser.employeeId
            ? t("vote_label_you_not_votable")
            : t("vote_label_entry");

        pillsContainer.appendChild(youLabel);

        const existingVoteForEntry =
          existingVote && existingVote.entryEmployeeId === emp.employeeId;
        if (existingVoteForEntry) {
          const yourVote = document.createElement("span");
          yourVote.className = "vote-pill your-vote-pill";
          yourVote.textContent = t("vote_label_your_vote");
          pillsContainer.appendChild(yourVote);
        }

        main.appendChild(nameSpan);
        main.appendChild(pillsContainer);

        const right = document.createElement("div");
        const btn = document.createElement("button");
        btn.className = "button small vote-button";

        if (votingLocked) {
          btn.textContent = t("vote_button_locked");
          btn.disabled = true;
        } else if (emp.employeeId === currentUser.employeeId) {
          btn.textContent = t("vote_button_not_allowed");
          btn.disabled = true;
        } else {
          btn.textContent = existingVoteForEntry
            ? t("vote_button_remove")
            : t("vote_button_vote");
          btn.addEventListener("click", () => handleVote(catId, emp.employeeId));
        }

        right.appendChild(btn);

        row.appendChild(main);
        row.appendChild(right);
        voteListEl.appendChild(row);
      });

      updateVoteLockMessage();
    }

    // ---------- RESULTAT ----------

    function computeCategoryResults(catId) {
      const catEntries = entries
        .filter(e => e.categoryId === catId)
        .map(e => ({
          employeeId: e.employeeId,
          employee: findEmployeeById(e.employeeId)
        }))
        .filter(e => !!e.employee);

      const counts = {};
      votes
        .filter(v => v.categoryId === catId)
        .forEach(v => {
          counts[v.entryEmployeeId] = (counts[v.entryEmployeeId] || 0) + 1;
        });

      const list = catEntries.map(e => ({
        employeeId: e.employeeId,
        name: e.employee.displayName,
        votes: counts[e.employeeId] || 0
      }));

      list.sort((a, b) => {
        if (b.votes !== a.votes) return b.votes - a.votes;
        return a.name.localeCompare(b.name);
      });

      const maxVotes = list.length > 0 ? list[0].votes : 0;
      const hasTieForFirst =
        maxVotes > 0 && list.filter(e => e.votes === maxVotes).length > 1;

      return { list, hasTieForFirst, maxVotes };
    }

    function getPositionLabel(rank) {
      if (currentLanguage === "sv") {
        if (rank === 1) return "1:a";
        return rank + ":a";
      } else {
        let suffix = "th";
        if (rank === 1) suffix = "st";
        else if (rank === 2) suffix = "nd";
        else if (rank === 3) suffix = "rd";
        return rank + suffix;
      }
    }

    function renderEntriesView() {
      entriesSectionsEl.innerHTML = "";
      CATEGORIES.forEach(cat => {
        const { list, hasTieForFirst } = computeCategoryResults(cat.id);

        const section = document.createElement("div");
        section.className = "category-section";

        const h3 = document.createElement("h3");
        h3.innerHTML =
          '<span class="emoji">' +
          cat.icon +
          "</span><span>" +
          getCategoryLabel(cat.id) +
          "</span>";
        section.appendChild(h3);

        const wrapper = document.createElement("div");
        wrapper.className = "entry-list";

        if (list.length === 0) {
          const row = document.createElement("div");
          row.className = "entry-row";
          row.textContent = t("results_no_entries");
          wrapper.appendChild(row);
        } else {
          list.forEach((item, index) => {
            const row = document.createElement("div");
            row.className = "entry-row";

            const main = document.createElement("div");
            main.className = "entry-main";

            const pos = document.createElement("div");
            pos.className = "position-badge";
            const rank = index + 1;
            pos.textContent = getPositionLabel(rank);

            if (rank === 1) pos.classList.add("position-gold");
            else if (rank === 2) pos.classList.add("position-silver");
            else if (rank === 3) pos.classList.add("position-bronze");

            const name = document.createElement("div");
            name.className = "entry-name";
            name.textContent = item.name;

            main.appendChild(pos);
            main.appendChild(name);

            const right = document.createElement("div");
            right.className = "entry-right";

            if (hasTieForFirst && item.votes === list[0].votes && item.votes > 0) {
              const tie = document.createElement("span");
              tie.className = "tie-badge";
              tie.textContent = t("results_tie");
              right.appendChild(tie);
            }

            const votesLabel = document.createElement("span");
            votesLabel.textContent = t("results_votes_label", {
              COUNT: item.votes
            });
            right.appendChild(votesLabel);

            row.appendChild(main);
            row.appendChild(right);
            wrapper.appendChild(row);
          });
        }

        section.appendChild(wrapper);
        entriesSectionsEl.appendChild(section);
      });
    }

    // ---------- ADMIN ----------

    function renderAdminView() {
      adminSectionsEl.innerHTML = "";
      CATEGORIES.forEach(cat => {
        const section = document.createElement("div");
        section.className = "category-section";

        const h3 = document.createElement("h3");
        h3.innerHTML =
          '<span class="emoji">' +
          cat.icon +
          "</span><span>" +
          getCategoryLabel(cat.id) +
          "</span>";
        section.appendChild(h3);

        const wrapper = document.createElement("div");
        wrapper.className = "entry-list";

        const catEntries = entries
          .filter(e => e.categoryId === cat.id)
          .map(e => ({
            employeeId: e.employeeId,
            employee: findEmployeeById(e.employeeId)
          }))
          .filter(e => !!e.employee)
          .sort((a, b) =>
            a.employee.displayName.localeCompare(b.employee.displayName)
          );

        if (catEntries.length === 0) {
          const row = document.createElement("div");
          row.className = "entry-row";
          row.textContent = t("admin_no_entries");
          wrapper.appendChild(row);
        } else {
          catEntries.forEach(entry => {
            const row = document.createElement("div");
            row.className = "entry-row";

            const main = document.createElement("div");
            main.className = "entry-main";

            const name = document.createElement("div");
            name.className = "entry-name";
            name.textContent = entry.employee.displayName;

            const idLabel = document.createElement("div");
            idLabel.className = "vote-pill";
            idLabel.textContent = "No. " + entry.employeeId;

            main.appendChild(name);
            main.appendChild(idLabel);

            const right = document.createElement("div");
            const btn = document.createElement("button");
            btn.className = "button small danger remove-button";
            btn.textContent = t("admin_remove_button");
            btn.addEventListener("click", () => {
              if (
                !confirm(
                  t("admin_remove_confirm", {
                    NAME: entry.employee.displayName,
                    CATEGORY: getCategoryLabel(cat.id)
                  })
                )
              )
                return;

              entries = entries.filter(
                e =>
                  !(
                    e.employeeId === entry.employeeId && e.categoryId === cat.id
                  )
              );
              votes = votes.filter(
                v =>
                  !(
                    v.categoryId === cat.id &&
                    v.entryEmployeeId === entry.employeeId
                  )
              );
              saveJson(STORAGE_KEYS.entries, entries);
              saveJson(STORAGE_KEYS.votes, votes);
              renderAdminView();
              renderEntriesView();
              renderVoteList();
              updateEnterStatus();
            });

            right.appendChild(btn);

            row.appendChild(main);
            row.appendChild(right);
            wrapper.appendChild(row);
          });
        }

        section.appendChild(wrapper);
        adminSectionsEl.appendChild(section);
      });

      updateVoteLockUI();
    }

          // ---------- EXPORT / IMPORT AV DATA ----------

    function exportAllData() {
      if (!isAdmin) return;

      const data = {
        entries,
        votes,
        votingLocked
      };

      const blob = new Blob([JSON.stringify(data, null, 2)], {
        type: "application/json"
      });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      const stamp = new Date().toISOString().replace(/[:.]/g, "-");
      a.href = url;
      a.download = "lamnea_jultra_data_" + stamp + ".json";
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);

      if (adminExportMessageEl) {
        adminExportMessageEl.textContent = t("admin_export_success");
        adminExportMessageEl.className = "message success";
      }
    }

    function importAllDataFromFile(file) {
      if (!isAdmin || !file) return;

      const reader = new FileReader();
      reader.onload = e => {
        try {
          const data = JSON.parse(e.target.result);
          if (!data || !Array.isArray(data.entries) || !Array.isArray(data.votes)) {
            throw new Error("Bad format");
          }

          entries = data.entries;
          votes = data.votes;
          votingLocked = !!data.votingLocked;

          saveJson(STORAGE_KEYS.entries, entries);
          saveJson(STORAGE_KEYS.votes, votes);
          saveVotingLock();

          renderEntriesView();
          renderAdminView();
          renderVoteList();
          updateEnterStatus();

          if (adminExportMessageEl) {
            adminExportMessageEl.textContent = t("admin_import_success");
            adminExportMessageEl.className = "message success";
          }
        } catch (err) {
          console.error(err);
          if (adminExportMessageEl) {
            adminExportMessageEl.textContent = t("admin_import_error");
            adminExportMessageEl.className = "message error";
          }
        }
      };
      reader.readAsText(file);
    }


    // ---------- LOGIN / LOGOUT / ADMIN ----------

    function handleLogin() {
      loginErrorEl.style.display = "none";
      loginErrorEl.textContent = "";
      const numStr = loginNumberInput.value.trim();
      if (!numStr) {
        loginErrorEl.textContent = t("login_error_empty");
        loginErrorEl.style.display = "block";
        return;
      }
      const num = parseInt(numStr, 10);
      if (!Number.isFinite(num)) {
        loginErrorEl.textContent = t("login_error_invalid");
        loginErrorEl.style.display = "block";
        return;
      }
      const employee = findEmployeeById(num);
      if (!employee) {
        loginErrorEl.textContent = t("login_error_notfound");
        loginErrorEl.style.display = "block";
        return;
      }

      currentUser = {
        employeeId: employee.employeeId,
        displayName: employee.displayName
      };
      saveJson(STORAGE_KEYS.currentUser, currentUser);
      updateLoginStatus();
      updateEnterStatus();
      renderVoteList();
      setView("home-view");
    }

    function handleLogout() {
      currentUser = null;
      isAdmin = false;
      localStorage.removeItem(STORAGE_KEYS.currentUser);
      localStorage.removeItem(STORAGE_KEYS.isAdmin);
      updateLoginStatus();
      updateEnterStatus();
      setView("login-view");
    }

    function ensureAdmin() {
      if (isAdmin) {
        setView("admin-view");
        return;
      }
      const code = prompt(t("admin_code_prompt"));
      if (code && code.trim() === "LB2025") {
        isAdmin = true;
        localStorage.setItem(STORAGE_KEYS.isAdmin, "1");
        setView("admin-view");
      } else if (code !== null) {
        alert(t("admin_code_incorrect"));
      }
    }

    // ---------- INIT & EVENTS ----------

    document.getElementById("btn-login").addEventListener("click", handleLogin);
    loginNumberInput.addEventListener("keydown", e => {
      if (e.key === "Enter") handleLogin();
    });

    navButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        const viewId = btn.getAttribute("data-view");
        if (!currentUser && viewId !== "login-view") {
          setView("login-view");
        } else {
          setView(viewId);
        }
      });
    });

    btnEnterConfirm.addEventListener("click", handleEnterConfirm);
    btnLeaveCategory.addEventListener("click", handleLeaveCategory);
    btnEnterBack.addEventListener("click", () => setView("home-view"));

    btnVoteBack.addEventListener("click", () => setView("home-view"));
    btnEntriesBack.addEventListener("click", () => setView("home-view"));
    btnAdminBack.addEventListener("click", () => setView("home-view"));

    btnAdmin.addEventListener("click", ensureAdmin);
    btnLogout.addEventListener("click", handleLogout);

    // spr√•kknappar
    document.querySelectorAll(".lang-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        const lang = btn.getAttribute("data-lang");
        applyLanguage(lang);
      });
    });

    // toggla r√∂st-l√•s
    btnToggleVoteLock.addEventListener("click", () => {
      votingLocked = !votingLocked;
      saveVotingLock();
      updateVoteLockUI();
      renderVoteList();
    });

    // NYTT: export/import-knappar
    if (btnExportData) {
      btnExportData.addEventListener("click", () => {
        if (adminExportMessageEl) {
          adminExportMessageEl.textContent = "";
          adminExportMessageEl.className = "message";
        }
        exportAllData();
      });
    }

    if (btnImportData && importFileInput) {
      btnImportData.addEventListener("click", () => {
        if (adminExportMessageEl) {
          adminExportMessageEl.textContent = "";
          adminExportMessageEl.className = "message";
        }
        importFileInput.value = "";
        importFileInput.click();
      });

      importFileInput.addEventListener("change", () => {
        const file = importFileInput.files[0];
        if (file) {
          importAllDataFromFile(file);
        }
      });
    }


    function updateAllOnLoad() {
      if (currentUser && !findEmployeeById(currentUser.employeeId)) {
        currentUser = null;
        localStorage.removeItem(STORAGE_KEYS.currentUser);
      }
      renderEnterCategoryChips();
      renderVoteCategoryChips();
      updateEnterStatus();
      renderVoteList();
      renderEntriesView();
      renderAdminView();
      updateLoginStatus();
      updateVoteLockUI();
      updateVoteLockMessage();

      if (!currentUser) {
        setView("login-view");
      } else {
        setView("home-view");
      }
    }

    // start med sparat spr√•k
    applyLanguage(currentLanguage);
    updateAllOnLoad();
  </script>
</body>
</html>
